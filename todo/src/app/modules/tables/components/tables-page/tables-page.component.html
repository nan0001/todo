<ng-container>
  <div class="title-container">
    <h3 class="title">Global Forbes 2000 Top-15</h3>
    <div class="btn-container">
      <button
        mat-raised-button
        class="edit-all-btn"
        (click)="toggleEditPopup(null, true)"
        [disabled]="checkedItems.length === 0">
        Edit checked items
      </button>
      <button mat-raised-button class="add-btn" (click)="toggleEditPopup()">
        Add new row
      </button>
    </div>
  </div>
  <table
    mat-table
    class="mat-elevation-z8 company-table"
    [dataSource]="dataSource">
    <ng-container matColumnDef="checkbox">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox
          [checked]="allChecked"
          [indeterminate]="checkedItems.length > 0 && !allChecked"
          (change)="setAllChecked($event.checked)"
          class="flag-checkbox">
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let element">
        <mat-checkbox
          (change)="checkItem(element)"
          [checked]="isElemInChecked(element)"
          class="flag-checkbox">
        </mat-checkbox>
      </td>
    </ng-container>

    <ng-container matColumnDef="position">
      <th mat-header-cell *matHeaderCellDef class="position">#</th>
      <td mat-cell *matCellDef="let element" class="position">
        {{ element['#'] }}
      </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Company name</th>
      <td mat-cell *matCellDef="let element" class="company-name">
        {{ element['Company name'] }}
      </td>
    </ng-container>

    <ng-container matColumnDef="location">
      <th mat-header-cell *matHeaderCellDef>Location</th>
      <td mat-cell *matCellDef="let element">{{ element.Location }}</td>
    </ng-container>

    <ng-container matColumnDef="sales">
      <th
        mat-header-cell
        *matHeaderCellDef
        [appCollapseColumns]="'sales'"
        [ngClass]="{ collapsed: collapsedColumns['sales'] }"
        [columnsList]="collapsedColumns">
        Sales, bln
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        [ngClass]="{ collapsed: collapsedColumns['sales'] }">
        {{ element.Sales | currency: 'USD' : 'symbol-narrow' : '1.2-2' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="profit">
      <th
        mat-header-cell
        *matHeaderCellDef
        [appCollapseColumns]="'profit'"
        [ngClass]="{ collapsed: collapsedColumns['profit'] }"
        [columnsList]="collapsedColumns">
        Profit, bln
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        [ngClass]="{ collapsed: collapsedColumns['profit'] }">
        {{ element.Profit | currency: 'USD' : 'symbol-narrow' : '1.2-2' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="assets">
      <th
        mat-header-cell
        *matHeaderCellDef
        [appCollapseColumns]="'assets'"
        [ngClass]="{ collapsed: collapsedColumns['assets'] }"
        [columnsList]="collapsedColumns">
        Assets, bln
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        [ngClass]="{ collapsed: collapsedColumns['assets'] }">
        {{ element.Assets | currency: 'USD' : 'symbol-narrow' : '1.2-2' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="flags">
      <th
        mat-header-cell
        *matHeaderCellDef
        [appCollapseColumns]="'flags'"
        [ngClass]="{ collapsed: collapsedColumns['flags'] }"
        [columnsList]="collapsedColumns">
        Flags
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        [ngClass]="{ collapsed: collapsedColumns['flags'] }">
        <ul class="checkbox-list">
          <li *ngFor="let flag of element.flags; let i = index">
            <mat-checkbox
              [color]="checkboxColors[i]"
              class="flag-checkbox"
              [checked]="flag.checked"
              (change)="updateItemFlag(element, i, flag)">
              {{ flag.name }}
            </mat-checkbox>
          </li>
        </ul>
      </td>
    </ng-container>

    <ng-container matColumnDef="edit">
      <th mat-header-cell *matHeaderCellDef class="edit"></th>
      <td mat-cell *matCellDef="let element" class="edit">
        <button
          mat-icon-button
          aria-label="Edit item"
          class="btn"
          (click)="toggleEditPopup(element)">
          <mat-icon>edit</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <ng-container *ngIf="isPopupOpened">
    <app-edit-popup
      [items]="itemToEdit"
      [itemArrayLength]="dataSource.data.length"></app-edit-popup>
  </ng-container>
  <ng-container *ngIf="isMultipleEditOpened">
    <app-edit-popup [items]="checkedItems" [multi]="true"></app-edit-popup>
  </ng-container>
</ng-container>
